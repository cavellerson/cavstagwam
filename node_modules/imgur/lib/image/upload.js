"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.upload = void 0;
const utils_1 = require("../common/utils");
const endpoints_1 = require("../common/endpoints");
async function upload(client, payload) {
    if (Array.isArray(payload)) {
        const promises = payload.map((p) => {
            const form = utils_1.createForm(p);
            const req = client.request(endpoints_1.UPLOAD_ENDPOINT, {
                method: 'POST',
                body: form,
                resolveBodyOnly: true,
            });
            const id = utils_1.getSource(p);
            req.on('uploadProgress', (progress) => {
                client.emit('uploadProgress', { ...progress, id });
            });
            return req;
        });
        return await Promise.all(promises);
    }
    const form = utils_1.createForm(payload);
    const req = client.request(endpoints_1.UPLOAD_ENDPOINT, {
        method: 'POST',
        body: form,
        resolveBodyOnly: true,
    });
    const id = utils_1.getSource(payload);
    req.on('uploadProgress', (progress) => {
        client.emit('uploadProgress', { ...progress, id });
    });
    return (await req);
}
exports.upload = upload;
//# sourceMappingURL=upload.js.map