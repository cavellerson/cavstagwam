<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head>
        <meta charset="utf-8">
        <title>@<%=username%> - cavstagwam</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
        <link rel="stylesheet" href="/styles.css">
    </head>

    <body>
        <%- include ('./partials/header.ejs') %>

        <% if (renderPage) { %>
            <div class="user-profile">
                <div class="top-profile">
                    <h1 class="profile-username"><%=username%></h1>
                    <% if (whichButtonToRender === 2) { %>

                    <% } else if (whichButtonToRender === 1) { %>
                        <form class="like-form" action="/unfollow/<%=username%>?_method=DELETE" method="POST">
                            <input id="action-buttons" class="btn btn-outline-danger" type="Submit" name="" value="Unfollow">
                        </form>
                    <% } else if (whichButtonToRender === 0) { %>
                        <form class="like-form" action="/follow/action/<%=username%>" method="POST"
                        >
                            <input id="action-buttons" class="btn btn-outline-primary" type="Submit" name="" value="Follow">
                        </form>
                    <% } %>
                </div>





                    <ul class="username-info-box">
                        <li>
                            <b><%=postsLength%></b> posts
                        </li>

                        <li>
                            <a href="/list/followers/<%=username%>"><b><span><%=followerLength%></b> followers</span></a>
                        </li>

                        <li>
                            <a href="/list/following/<%=username%>"><span><b><%=followingLength%></b> following</span></a>
                        </li>

                    </ul>



                <div class="all-posts">
                    <% for (let post of allPosts) { %>
                        <div class="user-post-box">
                        <% if (username === currentUser) { %>



                                <a href="/posts/<%=currentUser%>/<%=post.post_id%>/edit"><ion-icon name="ellipsis-horizontal-outline"></ion-icon></a>

                        <% } %>
                                <a href="/posts/<%=post.username%>/<%=post.post_id%>"><img  class="post-image" src="<%=post.image%>" alt="<%=post.image%>">
                                    <div class="post-likes-comments">
                                        <div class="post-likes">
                                            <ion-icon id="post-heart-icon" name="heart"></ion-icon>
                                            <span id="post-likes"><%=post.likes%></span>

                                                <% let commentNum = 0%>
                                                <% for (let comment of allComments) { %>
                                                    <% if (comment.post_id === post.post_id) { %>
                                                        <% commentNum++ %>
                                                    <% } %>
                                                <% } %>
                                        </div>
                                        <div class="post-comments">
                                            <ion-icon id="post-chat-icon" name="chatbubble"></ion-icon>
                                            <span id="comment-number"><%=commentNum%></span>
                                        </div>



                                    </div>

                                </a>

                        </div>

                    <% } %>
                </div>

            </div>
        <% } else { %>
            <div class="greeting">
                <h3>Sorry, this page isn't available.</h3>
                <p>The link you followed may be broken, or the page may have been removed. <a href="/">Go back to cavstagwam.</a></p>
            </div>

        <% } %>

        <script type="text/javascript">
            $('.picture-text').css('display','none')
            $('.user-post-box').hover((event) => {



                //decreases brightness
                $(event.currentTarget.children[1].children[0]).css('filter', 'brightness(50%)')
                $(event.currentTarget.children[1].children[0]).css('display', 'block')
                //shows the likes and comments number
                $(event.currentTarget.children[1].children[1]).css('display', 'flex')
                // console.log(event.currentTarget);

            },() => {
                //display none for the brightness
                $(event.currentTarget.children[1].children[0]).css('filter', 'none')
                //display none for comments and llikes
                $(event.currentTarget.children[1].children[1]).css('display', 'none')

            })

            



        </script>
    </body>
</html>
